# =============================================================================
# ENVIRONMENT VARIABLES - The Backstage
# =============================================================================
# All environment variables are validated at startup using Zod (lib/env.ts)
# The application will fail fast if required variables are missing or invalid.
# =============================================================================

# -----------------------------------------------------------------------------
# Node Environment
# -----------------------------------------------------------------------------
NODE_ENV=development  # development | production | test

# -----------------------------------------------------------------------------
# Database Configuration (Required)
# -----------------------------------------------------------------------------
# PostgreSQL connection (Vercel Postgres / Neon / Local)
POSTGRES_URL=postgresql://user:password@ep-xxx.neon.tech/neondb?sslmode=require

# Vercel Postgres specific (Optional - auto-provided by Vercel)
POSTGRES_PRISMA_URL=postgresql://user:password@ep-xxx.neon.tech/neondb?sslmode=require&pgbouncer=true&connect_timeout=15
POSTGRES_URL_NO_SSL=postgresql://user:password@ep-xxx.neon.tech/neondb
POSTGRES_URL_NON_POOLING=postgresql://user:password@ep-xxx.neon.tech/neondb?sslmode=require
POSTGRES_USER=user
POSTGRES_HOST=ep-xxx.neon.tech
POSTGRES_PASSWORD=password
POSTGRES_DATABASE=neondb

# Connection Pool Configuration (Optional)
# Defaults are optimized for Vercel serverless environment
# Adjust based on your Vercel Postgres plan:
# - Hobby Plan: 60 max connections total
# - Pro Plan: 120 max connections total
# Keep pool sizes small (max: 10) to avoid exhausting database connection limits
DB_POOL_MAX=10                    # Maximum connections per serverless instance
DB_POOL_MIN=2                     # Minimum idle connections to maintain
DB_CONNECTION_TIMEOUT=5000        # Timeout to acquire connection from pool (ms)
DB_IDLE_TIMEOUT=30000             # Close idle connections after this period (ms)
DB_MAX_LIFETIME=3600000           # Maximum lifetime of a connection (ms) - 1 hour
DB_STATEMENT_TIMEOUT=10000        # Default query timeout (ms) - 10 seconds

# -----------------------------------------------------------------------------
# NextAuth Configuration (Required)
# -----------------------------------------------------------------------------
NEXTAUTH_URL=http://localhost:3002

# NextAuth Secret (Required)
# Generate with: openssl rand -base64 32
# NextAuth v5 uses AUTH_SECRET, but NEXTAUTH_SECRET is supported for backward compatibility
AUTH_SECRET=your_random_secret_here_minimum_32_characters_required_for_security
# Legacy (still supported):
# NEXTAUTH_SECRET=your_random_secret_here_minimum_32_characters_required_for_security

# -----------------------------------------------------------------------------
# Email Configuration
# -----------------------------------------------------------------------------
# Resend API (Primary email provider)
RESEND_API_KEY=re_your_resend_api_key_here
SENDER_EMAIL=noreply@thebackstage.app

# Mailgun API (Alternative email provider)
# Get from: https://app.mailgun.com/ → Settings → API Keys
MAILGUN_API_KEY=your_mailgun_api_key_here
MAILGUN_DOMAIN=yourdomain.com  # or sandboxXXXXX.mailgun.org for testing
MAILGUN_API_URL=https://api.mailgun.net
MAILGUN_WEBHOOK_SIGNING_KEY=your_mailgun_webhook_signing_key

# Feature flag: Use Mailgun instead of Resend
USE_MAILGUN=false  # Set to true to use Mailgun

# Admin notifications
ADMIN_EMAIL=admin@example.com

# Email recipients (JSON array - for testing)
RECIPIENT_EMAILS=["email1@example.com","email2@example.com"]

# Legacy email providers (Deprecated - for backward compatibility)
BREVO_API_KEY=your_brevo_api_key_here
BREVO_TEMPLATE_ID=your_template_id_here
POSTMARK_API_KEY=your_postmark_api_key_here
POSTMARK_TEMPLATE_ID=your_template_id_here
SENDGRID_API_KEY=your_sendgrid_api_key_here

# -----------------------------------------------------------------------------
# Download Gates
# -----------------------------------------------------------------------------
DOWNLOAD_TOKEN_SECRET=your_random_64_character_string_here_for_token_generation

# -----------------------------------------------------------------------------
# Admin Configuration
# -----------------------------------------------------------------------------
ADMIN_SECRET=dev-secret-123  # Secret for admin operations (change in production!)

# -----------------------------------------------------------------------------
# SoundCloud Configuration
# -----------------------------------------------------------------------------
SOUNDCLOUD_USER_ID=1318247880
SOUNDCLOUD_CLIENT_ID=your_soundcloud_client_id
SOUNDCLOUD_CLIENT_SECRET=your_soundcloud_client_secret
SOUNDCLOUD_REDIRECT_URI=https://thebackstage.app/api/auth/soundcloud/callback

# -----------------------------------------------------------------------------
# Spotify Configuration
# -----------------------------------------------------------------------------
SPOTIFY_CLIENT_ID=your_spotify_client_id
SPOTIFY_CLIENT_SECRET=your_spotify_client_secret
SPOTIFY_REDIRECT_URI=https://thebackstage.app/api/auth/spotify/callback
SPOTIFY_ARTIST_ID=your_spotify_artist_id

# -----------------------------------------------------------------------------
# Cloudinary Configuration (Image Storage)
# -----------------------------------------------------------------------------
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_cloudinary_api_key
CLOUDINARY_API_SECRET=your_cloudinary_api_secret

# -----------------------------------------------------------------------------
# Webhook Secrets
# -----------------------------------------------------------------------------
# Hypedit webhook verification (simple secret matching)
HYPEDIT_WEBHOOK_SECRET=your_hypedit_webhook_secret

# Resend webhook verification (HMAC-SHA256 signature)
# Get from: Resend Dashboard → Webhooks → [Your Endpoint] → Signing Secret
# Format: whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# Used to verify webhook authenticity and prevent malicious requests
RESEND_WEBHOOK_SECRET=whsec_your_resend_webhook_signing_secret

# Mailgun webhook verification (HMAC-SHA256 signature)
# Get from: Mailgun Dashboard → Sending → Webhooks → [Your Domain] → Signing Key
# Used to verify webhook authenticity and prevent malicious requests
# (Already included in email configuration above as MAILGUN_WEBHOOK_SIGNING_KEY)

# -----------------------------------------------------------------------------
# Stripe Configuration (Payment Processing)
# -----------------------------------------------------------------------------
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key

# Stripe webhook verification (HMAC-SHA256 signature via Stripe SDK)
# Get from: Stripe Dashboard → Developers → Webhooks → [Your Endpoint] → Signing Secret
# Format: whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# Used by stripe.webhooks.constructEvent() to verify webhook authenticity
STRIPE_WEBHOOK_SECRET=whsec_your_stripe_webhook_signing_secret

# -----------------------------------------------------------------------------
# Application URLs
# -----------------------------------------------------------------------------
NEXT_PUBLIC_APP_URL=http://localhost:3002
BASE_URL=http://localhost:3002

# -----------------------------------------------------------------------------
# Upstash Redis - Rate Limiting (Optional but Recommended for Production)
# -----------------------------------------------------------------------------
# Vercel KV (Upstash Redis) for distributed rate limiting
# Setup: https://vercel.com/docs/storage/vercel-kv/quickstart
#
# Create a Vercel KV database:
# 1. Go to Vercel Dashboard > Storage > Create Database > KV
# 2. Copy the REST API credentials below
# 3. Auto-provided when deployed on Vercel
#
# If not configured, rate limiting will be disabled (graceful degradation)
UPSTASH_REDIS_REST_URL=https://your-redis-instance.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_upstash_redis_rest_token

# -----------------------------------------------------------------------------
# Feature Flags (Optional)
# -----------------------------------------------------------------------------
ENABLE_SOUNDCLOUD_OAUTH=false
ENABLE_SPOTIFY_OAUTH=false
ENABLE_EMAIL_VERIFICATION=false
ENABLE_ANALYTICS=false
ENABLE_EMAIL_TRACKING=false

# -----------------------------------------------------------------------------
# Sentry Configuration (Error Tracking & Observability)
# -----------------------------------------------------------------------------
# Sentry DSN for error tracking (get from sentry.io project settings)
SENTRY_DSN=https://your_public_key@o123456.ingest.sentry.io/123456

# Public DSN for client-side error tracking (same as SENTRY_DSN)
NEXT_PUBLIC_SENTRY_DSN=https://your_public_key@o123456.ingest.sentry.io/123456

# Sentry Organization slug (for source maps upload during build)
SENTRY_ORG=your-organization-slug

# Sentry Project name (for source maps upload during build)
SENTRY_PROJECT=backstage-app

# Sentry Auth Token (for uploading source maps - required for production builds)
# Generate at: https://sentry.io/settings/account/api/auth-tokens/
# Permissions needed: project:releases, project:write
SENTRY_AUTH_TOKEN=your_sentry_auth_token_here
